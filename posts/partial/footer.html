  <hr>
  <div id="footer">
    <h3>Comments</h3>
    <form>
      <input id="name" placeholder="your name" maxlength=16 required>
      <textarea id="comment-body" placeholder="your comment" required></textarea>
      <button id="submit-button" type="button" onclick="saveComment()"> Submit </button>
    </form>
    <div id="comments">
      There's nothing here yet. Be the first!
    </div>
  </div>
</div>
<script>
  const savedComments = new Set();

  fetch('https://l4oejeyzok.execute-api.us-west-2.amazonaws.com/default/get_comments', {
    method: 'POST',
    body: JSON.stringify({post_number:postNum}),
    headers: {
      'Content-Type':'application/json'
    }
  }).then(response => response.json())
    .then(data     => data.Items.forEach(displayComment))
    .catch(err     => console.log(err));


  function displayComment(comment){
    if (typeof comment == 'string') throw new Error(comment);

    // Strip the comment of all white space and add it to the comment set.
    savedComments.add(comment.comment_body.S.replace(/\s/g,''));

    const comments = document.getElementById('comments');

    // Remove the "There's nothing here yet" text on the first comment insert.
    if (comments.children.length == 0 ) {
      comments.innerHTML = ''
    }

    const date = new Date(parseInt(comment.time_stamp.N))
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();

    let newComment = document.createElement('div');

    newComment.classList.add("comment");
    newComment.innerHTML = `
      <div class="comment-name">
         <strong>${comment.comment_name.S}<span class="date">${month}/${day}/${year}</span></strong>
      </div>
      <div class="comment-body">
        ${comment.comment_body.S}
      </div>`;

    comments.prepend(newComment);
  }

  function saveComment(){
    const sanitizeString = (s) => {
      let temp = document.createElement('div');
      temp.textContent = s;
      return temp.innerHTML;
    };

    const name = sanitizeString(document.getElementById('name').value);
    const comment = sanitizeString(document.getElementById('comment-body').value);

    // Check that the comment name/body are not empty, and that the comment body is not a duplicate.
    if (!(name || comment) || savedComments.has(comment.replace(/\s/g,''))) return;

    document.getElementById("submit-button").disabled = true;

    fetch('https://l4oejeyzok.execute-api.us-west-2.amazonaws.com/default/post_comment', {
      method: 'POST',
      body: JSON.stringify({
        postNumber:postNum,
        commentName:name,
        commentBody:comment
      }),
      headers: {
        'Content-Type':'application/json'
      }
    }).then(response => response.json())
      .then(data     => displayComment(data))
      .then(()       => document.getElementById("submit-button").disabled = false)
      .catch(err     => console.log(err));
  }
</script>
